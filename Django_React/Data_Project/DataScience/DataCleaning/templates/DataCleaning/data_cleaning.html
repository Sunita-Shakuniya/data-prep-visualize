<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Display</title>
</head>
<body>
    <h1>Data Display</h1>

    {% if data_list %}
        {% if row_limit %}
            <p>Displaying the first {{ row_limit }} rows</p>
        {% endif %}
        <div   id="scrollableDiv"  style= "height: 500px; overflow-y: scroll;">
        <!-- Display original data -->
            <table  border="1">
                <thead>
                    <tr>
                        {% for column in data_list.0.keys %}
                            <th>{{ column }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody >
                    {% for row in data_list %}
                        <tr>
                            {% for value in row.values %}
                                <td>{{ value|safe }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <button id="reloadButton">Reload</button>
        <form method="post" action="{% url 'perform_operation' %}">
            {% csrf_token %}
        
            <label for="{{ operation_form.operation.id_for_label }}">Operation:</label>
            {{ operation_form.operation }}
        
            <label for="{{ operation_form.column_name.id_for_label }}">Columns to Delete:</label>
            <select multiple name="{{ operation_form.column_name.name }}">
                {% for column in operation_form.column_name.field.choices %}
                    <option value="{{ column.0 }}">{{ column.1 }}</option>
                {% endfor %}
            </select>
            <button type="submit">Perform Operation</button>
        </form>
        
        
        
        
        

    {% else %}
        <p>No data available.</p>
    {% endif %}
    <script>
        // Add this script to handle the button click event
        document.getElementById('reloadButton').addEventListener('click', function() {
          // Use JavaScript to make an asynchronous request to the reload_data view
          fetch('/reload_data/')
            .then(response => {
              if (response.ok) {
                // Reload the page if the request is successful
                location.reload();
              } else {
                console.error('Failed to reload data');
              }
            })
            .catch(error => {
              console.error('Error during reload:', error);
            });
        });



        function scrollToBottom() {
        // Get the reference to the scrollable div
        const scrollableDiv = document.getElementById('scrollableDiv');

        // Set scrollTop to scrollHeight to initially scroll to the bottom
        scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
        }

        // Call scrollToBottom when the page loads or when content changes
        window.onload = scrollToBottom;

        // Attach scrollToBottom to the click event of the reload button
        const reloadButton = document.getElementById('reloadButton');
        reloadButton.addEventListener('click', function () {
            // Assuming you have a function to reload data, replace loadData() with your actual function
            loadData();

            // After reloading data, scroll to the bottom
            scrollToBottom();
        });

        // Example function to simulate loading data
        function loadData() {
            // Replace this with your actual logic to load more data
            // For example, you might use AJAX, Fetch API, etc.
            console.log('Loading data...');
        }
      </script>
</body>
</html>
